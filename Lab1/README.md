# 💬 Lab1 – 多线程协议化聊天系统

> **课程实验：计算机网络 — 利用流式套接字实现一个多线程聊天室**

---

## 🧾 一、实验要求（原题概要）

1. **设计聊天协议**  
   - 定义通信格式与消息类型并给出完整说明；
   - 示例结构： `TYPE|SENDER|ACCEPTER|MESSAGE`。

2. **使用 C/C++ 原生 Socket**  
   - 不允许使用封装类库 (`CSocket`, `QTcpSocket` 等)；
   - 必须调用底层 Winsock API。

3. **程序界面与退出方式**  
   - 具有基本对话界面（命令行或 GUI）；
   - 支持正常退出（如输入 `/exit` 退出）。

4. **支持中英文聊天**  
   - 需正确显示 UTF‑8 中文与英文消息。

5. **采用多线程，支持多人聊天**  
   - 服务器：多线程同时处理多个客户端；
   - 客户端：分别用线程发送与接收。

6. **代码结构清晰，可读性好**  
   - 有合理的文件划分与注释。

7. **观察 TCP 数据传输情况**  
   - 使用 Wireshark 或 netstat 验证是否丢包；
   - 在实验报告中分析 TCP 可靠性。

---

## 🎯 二、自定义项目目标（简化微信式体系）

**定位：**  
构建一个“微信风格的简化即时通信系统”，提供最基础的 IM 体验：
- 无需登录注册；
- 支持昵称、群聊与点对点消息；
- 可扩展图形界面并保存聊天记录；
- 演示 TCP 多线程通信架构。

**功能特性：**
| 模块 | 功能描述 | 状态 |
|------|-----------|------|
| 协议层 | TYPE\|SENDER\|ACCEPTER\|MESSAGE | ✅ 完成 |
| 服务端 | 多线程并发处理 + 广播 + 退出管理 | ✅ 完成 |
| 客户端 | 双线程全双工通信 + 命令行交互 | ✅ 完成 |
| 中文支持 | UTF‑8 控制台显示 / PowerShell | ✅ 完成 |
| 界面层 | 计划引入 Qt / Python GUI | ⏳ 准备阶段 |
| 消息存储 | 保存聊天记录（文本/SQLite） | ⏳ 计划中 |
| 报告与展示 | 抓包、线程模型图、实验分析 | ⏳ 草稿阶段 |

---

## 🧩 三、项目结构
Lab1/
├── include/
│ ├── Common.h # 协议结构体 Message 与封装/解封装函数声明
│ ├── Server.h # 服务器端函数声明
│ └── Client.h # 客户端函数声明（预留）
├── src/
│ ├── Server.cpp # 完整的多线程服务器逻辑
│ ├── Client.cpp # 协议化客户端，双线程收发
│ └── Common.cpp # buildMessage / parseMessage 实现
├── build/ # 中间目标文件
├── Makefile # 自动构建脚本（nmake）
└── README.md # 当前说明文档

text


---

## ⚙️ 四、主要协议说明

| 字段名 | 含义 | 举例 |
|--------|------|------|
| `TYPE` | 消息类型：`JOIN`、`MSG`、`EXIT`、`SYS` | MSG |
| `SENDER` | 发送者昵称 | Alice |
| `ACCEPTER` | 接收方：用户昵称或 `ALL` | ALL |
| `MESSAGE` | 聊天内容文本 | 你好！ |

**样例交互：**